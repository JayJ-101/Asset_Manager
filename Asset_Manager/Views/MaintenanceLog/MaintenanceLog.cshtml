@model MaintenanceLogViewModel

@{
    var action = ViewContext.RouteData.Values["action"]?.ToString()?.Capitalize() ?? "Add";
    ViewData["Title"] = $"  {action} Maintenance Log";
    var isDelete = action.EqualsNoCase("delete");
}


<form asp-action="@action" method="post">
    <input type="hidden" asp-for="MaintenanceLog.MaintenanceId" />


    @* Operation field needed by remote validation *@
    <input type="hidden" name="Operation" value="@action" />

    @if (isDelete)
    {
        <div class="alert alert-warning">
            <h5>Are you sure you want to delete this maintenance record?</h5>
            <p><strong>Asset:</strong> @Model.MaintenanceLog.Asset?.AssetName</p>
            <p><strong>Technician:</strong> @Model.MaintenanceLog.Tecnician</p>
            <p><strong>Status:</strong> @Model.MaintenanceLog.Status</p>
        </div>
    }
    else
    {
        <div class="row mb-3">
            <label class="col-md-2 col-form-label">Asset:</label>
            <div class="col-md-6">
                <select asp-for="MaintenanceLog.AssetId" class="form-select select2">
                    <option value="">Select Asset</option>
                    @foreach (var asset in Model.Assets)
                    {
                        var label = $"{asset.AssetName} ({asset.SerialNumber}) - {asset.Manufacturer}";
                        <option value="@asset.AssetId">@label</option>
                    }
                </select>
                <span asp-validation-for="MaintenanceLog.AssetId" class="text-danger"></span>
            </div>
        </div>

        <div class="row mb-3">
            <label asp-for="MaintenanceLog.Tecnician" class="col-md-2 col-form-label">Technician:</label>
            <div class="col-md-6">
                <input type="text" asp-for="MaintenanceLog.Tecnician" class="form-control" />
                <span asp-validation-for="MaintenanceLog.Tecnician" class="text-danger"></span>
            </div>
        </div>

        <div class="row mb-3">
            <label asp-for="MaintenanceLog.Description" class="col-md-2 col-form-label">Description:</label>
            <div class="col-md-6">
                <textarea asp-for="MaintenanceLog.Description" class="form-control"></textarea>
                <span asp-validation-for="MaintenanceLog.Description" class="text-danger"></span>
            </div>
        </div>

        <div class="row mb-3">
            <label asp-for="MaintenanceLog.LoggedDate" class="col-md-2 col-form-label">Logged Date:</label>
            <div class="col-md-4">
                <input type="date" asp-for="MaintenanceLog.LoggedDate" class="form-control" />
                <span asp-validation-for="MaintenanceLog.LoggedDate" class="text-danger"></span>
            </div>
        </div>

        <div class="row mb-3">
            <label asp-for="MaintenanceLog.CompletionDate" class="col-md-2 col-form-label">Completion Date:</label>
            <div class="col-md-4">
                <input type="date" asp-for="MaintenanceLog.CompletionDate" class="form-control" />
                <span asp-validation-for="MaintenanceLog.CompletionDate" class="text-danger"></span>
            </div>
        </div>

        <div class="row mb-3">
            <label asp-for="MaintenanceLog.Status" class="col-md-2 col-form-label">Status:</label>
            <div class="col-md-4">
                <select asp-for="MaintenanceLog.Status" class="form-select">
                    <option value="">Select Status</option>
                    <option value="Pending">Pending</option>
                    <option value="In Progress">In Progress</option>
                    <option value="Completed">Completed</option>
                </select>
                <span asp-validation-for="MaintenanceLog.Status" class="text-danger"></span>
            </div>
        </div>
    }

    <div class="row mt-4">
        <div class="col-md-6 offset-md-2">
            <button type="submit" class="btn btn-primary">@action</button>
            <a asp-action="Index" class="btn btn-secondary ms-2">Cancel</a>
        </div>
    </div>
</form>

@section Scripts {
    @await Html.PartialAsync("_ValidationScriptsPartial")

    <script>
        $(document).ready(function () {
            $('.select2').select2({
                placeholder: "Select an asset",
                allowClear: true
            });
        });
    </script>
}
