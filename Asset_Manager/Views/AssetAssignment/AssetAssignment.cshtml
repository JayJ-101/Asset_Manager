@model AssignmentViewModel

@{
    var action = ViewContext.RouteData.Values["action"]?.ToString()?.Capitalize() ?? "Add";
    ViewData["Title"] = $" | {action} Asset Assignment";
    var isDelete = action.EqualsNoCase("delete");
}

<h2 class="mb-4">@action Asset Assignment</h2>

<form asp-action="@action" method="post">
    <input type="hidden" asp-for="AssetAssignment.AssingmentId" />
    <input type="hidden" name="Operation" value="@action" />

    @if (isDelete)
    {
        <div class="alert alert-warning">
            <h5>Are you sure you want to delete this assignment?</h5>
            <p><strong>Asset:</strong> @Model.AssetAssignment.Asset?.AssetName</p>
            <p><strong>Assigned To:</strong> @Model.AssetAssignment.Employee</p>
            <p><strong>Branch:</strong> @Model.AssetAssignment.Branch?.BranchName</p>
        </div>
    }
    else
    {
        <div class="row mb-3">
            <label class="col-md-2 col-form-label">Asset:</label>
            <div class="col-md-6">
                @if (Model.AssetAssignment.AssetId != 0)
                {
                    var selectedAsset = Model.Assets.FirstOrDefault(a => a.AssetId == Model.AssetAssignment.AssetId);
                    <input type="text" class="form-control" value="@selectedAsset?.AssetName" disabled />
                    <input type="hidden" asp-for="AssetAssignment.AssetId" />
                }
                else
                {
                    <select asp-for="AssetAssignment.AssetId" class="form-select select2">
                        <option value="">Select Asset</option>
                        @foreach (var asset in Model.Assets)
                        {
                            var label = $"{asset.AssetName} ({asset.SerialNumber}) - {asset.Manufacturer}";
                            <option value="@asset.AssetId">@label</option>
                        }
                    </select>


                    <span asp-validation-for="AssetAssignment.AssetId" class="text-danger"></span>
                }
            </div>
        </div>

        <div class="row mb-3">
            <label class="col-md-2 col-form-label">Branch:</label>
            <div class="col-md-6">
                <select asp-for="AssetAssignment.BranchId" class="form-select"
                        asp-items='@new SelectList(Model.Branches, "BranchId", "BranchName", Model.AssetAssignment.BranchId)'></select>
                <span asp-validation-for="AssetAssignment.BranchId" class="text-danger"></span>
            </div>
        </div>

        <div class="row mb-3">
            <label class="col-md-2 col-form-label">Department:</label>
            <div class="col-md-6">
                <select asp-for="AssetAssignment.DepartmentId" class="form-select"
                        asp-items='@new SelectList(Model.Departments, "DepartmentId", "DepartmentName", Model.AssetAssignment.DepartmentId)'></select>
                <span asp-validation-for="AssetAssignment.DepartmentId" class="text-danger"></span>
            </div>
        </div>

        <div class="row mb-3">
            <label asp-for="AssetAssignment.AssetTag" class="col-md-2 col-form-label">Asset Tag:</label>
            <div class="col-md-6">
                <input type="text" asp-for="AssetAssignment.AssetTag" class="form-control" />
                <span asp-validation-for="AssetAssignment.AssetTag" class="text-danger"></span>
            </div>
        </div>

        <div class="row mb-3">
            <label asp-for="AssetAssignment.Employee" class="col-md-2 col-form-label">Employee:</label>
            <div class="col-md-6">
                <input type="text" asp-for="AssetAssignment.Employee" class="form-control" />
                <span asp-validation-for="AssetAssignment.Employee" class="text-danger"></span>
            </div>
        </div>

        <div class="row mb-3">
            <label asp-for="AssetAssignment.AssginedDate" class="col-md-2 col-form-label">Assigned Date:</label>
            <div class="col-md-4">
                <input type="date" asp-for="AssetAssignment.AssginedDate" class="form-control" />
                <span asp-validation-for="AssetAssignment.AssginedDate" class="text-danger"></span>
            </div>
        </div>

        <div class="row mb-3">
            <label asp-for="AssetAssignment.ReturnDate" class="col-md-2 col-form-label">Return Date:</label>
            <div class="col-md-4">
                <input type="date" asp-for="AssetAssignment.ReturnDate" class="form-control" />
                <span asp-validation-for="AssetAssignment.ReturnDate" class="text-danger"></span>
            </div>
        </div>
    }

    <div class="row mt-4">
        <div class="col-md-6 offset-md-2">
            <button type="submit" class="btn btn-primary">@action</button>
            <a asp-action="Index" class="btn btn-secondary ms-2">Cancel</a>
        </div>
    </div>
</form>

@section Scripts {
    @await Html.PartialAsync("_ValidationScriptsPartial")

    <script>
        $(document).ready(function () {
            $('.select2').select2({
                placeholder: "Select an asset",
                allowClear: true
            });
        });
    </script>
}
