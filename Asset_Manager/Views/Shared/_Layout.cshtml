@{
    var current = ViewContext.RouteData.Values["area"]?.ToString() ??
                  ViewContext.RouteData.Values["controller"]?.ToString() ?? "Home";
    var action = ViewContext.RouteData.Values["action"]?.ToString() ?? "Index";
}

<!DOCTYPE html>
<html lang="en" data-bs-theme="light">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="Enterprise Asset Management System" />
    <title>@ViewData["Title"] - Asset Manager</title>

    <!-- Preload & Favicons -->
    <link rel="preload" href="~/css/site.css" as="style" />
    <link rel="icon" href="~/favicon.ico" type="image/x-icon" />
    <link rel="apple-touch-icon" sizes="180x180" href="~/apple-touch-icon.png" />

    <!-- Font Awesome & Bootstrap -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
          crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link href="~/lib/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet" />

    <!-- Custom CSS -->
    <link rel="stylesheet" href="~/css/site.css" asp-append-version="true" />
    @RenderSection("Styles", required: false)
</head>
<body class="d-flex min-vh-100 bg-light">
    
    <!-- Sidebar -->
    <nav id="sidebarMenu"
         class="sidebar d-flex flex-column p-3 text-white offcanvas-lg offcanvas-start bg-primary"
         tabindex="-1">

        <!-- Branding -->
        <div class="sidebar-header d-flex align-items-center mb-4">
            <i class="fas fa-server fs-4 me-2"></i>
            <span class="fs-4 fw-bold">Asset Manager</span>
        </div>

        <!-- Navigation -->
        <ul class="nav flex-column sidebar-nav">

            <!-- Dashboard -->
            <li class="nav-item mb-1">
                <a class="nav-link sidebar-link @(current == "Home" ? "active" : "")"
                   asp-controller="Home" asp-action="Index">
                    <i class="fas fa-home me-3"></i>
                    Dashboard
                </a>
            </li>

            <!-- Assets -->
            <li class="nav-item mb-1">
                <a class="nav-link sidebar-link d-flex justify-content-between @(current == "Asset" || current == "AssetAssignment" || current == "MaintenanceLog" ? "active" : "")"
                   data-bs-toggle="collapse" href="#assetsMenu" role="button"
                   aria-expanded="@(current == "Asset" || current == "AssetAssignment" || current == "MaintenanceLog" ? "true" : "false")">

                    <span><i class="fas fa-laptop me-3"></i>Assets</span>
                    <i class="fas fa-chevron-down small chevron"></i>
                </a>

                <div class="collapse submenu ps-4 @(current == "Asset" || current == "AssetAssignment" || current == "MaintenanceLog" ? "show" : "")"
                     id="assetsMenu">
                    <a class="nav-link sub-link @(current == "Asset" ? "active-sub" : "")"
                       asp-controller="Asset" asp-action="Index">All Assets</a>

                    <a class="nav-link sub-link @(current == "AssetAssignment" ? "active-sub" : "")"
                       asp-controller="AssetAssignment" asp-action="Index">Assignments</a>

                    <a class="nav-link sub-link @(current == "MaintenanceLog" ? "active-sub" : "")"
                       asp-controller="MaintenanceLog" asp-action="Index">Maintenance</a>
                </div>
            </li>

            <!-- Management -->
            <li class="nav-item mb-1">
                <a class="nav-link sidebar-link d-flex justify-content-between @(current == "Supplier" || current == "Category" || current == "Branch" || current == "Department" ? "active" : "")"
                   data-bs-toggle="collapse" href="#mgmtMenu" role="button"
                   aria-expanded="@(current == "Supplier" || current == "Category" || current == "Branch" || current == "Department" ? "true" : "false")">

                    <span><i class="fas fa-cog me-3"></i>Management</span>
                    <i class="fas fa-chevron-down small chevron"></i>
                </a>

                <div class="collapse submenu ps-4 @(current == "Supplier" || current == "Category" || current == "Branch" || current == "Department" ? "show" : "")"
                     id="mgmtMenu">

                    <a class="nav-link sub-link @(current == "Supplier" ? "active-sub" : "")"
                       asp-controller="Supplier" asp-action="Index">Suppliers</a>

                    <a class="nav-link sub-link @(current == "Category" ? "active-sub" : "")"
                       asp-controller="Category" asp-action="Index">Categories</a>

                    <a class="nav-link sub-link @(current == "Branch" ? "active-sub" : "")"
                       asp-controller="Branch" asp-action="Index">Branches</a>

                    <a class="nav-link sub-link @(current == "Department" ? "active-sub" : "")"
                       asp-controller="Department" asp-action="Index">Departments</a>
                </div>
            </li>

        </ul>
    </nav>


    <!-- Main Area -->
    <div class="flex-grow-1 d-flex flex-column">
        <!-- Top Navbar -->
        <header class="topbar navbar shadow-sm px-3 bg-white">
            <!-- Mobile Toggle -->
            <button class="btn btn-outline-primary d-lg-none me-2"
                    type="button" data-bs-toggle="offcanvas" data-bs-target="#sidebarMenu">
                <i class="fas fa-bars"></i>
            </button>

            <!-- Search -->
            <form class="search-bar d-flex align-items-center me-auto"
                  asp-controller="Asset" asp-action="Index" method="get">
                <div class="input-group input-group-sm">
                    <span class="input-group-text bg-light border-end-0">
                        <i class="fas fa-search"></i>
                    </span>
                    <input type="search"
                           name="searchQuery"
                           class="form-control border-start-0 shadow-none"
                           placeholder="Search assets...">
                </div>
            </form>

            <!-- User Menu -->
            <div class="dropdown">
                <a href="#" class="d-flex align-items-center text-dark text-decoration-none dropdown-toggle"
                   id="userMenu" data-bs-toggle="dropdown" aria-expanded="false">
                    <img src="~/img/user.png"
                         alt="User"
                         width="32" height="32"
                         class="rounded-circle me-2 shadow-sm border">
                    <span class="fw-semibold">User</span>
                </a>

                <ul class="dropdown-menu dropdown-menu-end shadow-sm" aria-labelledby="userMenu">
                    <li><a class="dropdown-item" href="#"><i class="fas fa-user me-2"></i> Profile</a></li>
                    <li><hr class="dropdown-divider" /></li>
                    <li>
                        <a class="dropdown-item text-danger"
                           asp-controller="Account" asp-action="Logout">
                            <i class="fas fa-sign-out-alt me-2"></i> Sign out
                        </a>
                    </li>
                </ul>
            </div>

            <!-- Optional Buttons -->
            <div>
                @RenderSection("ActionButtons", required: false)
            </div>
        </header>


        <!-- Main Content -->
        <main id="main-content" class="flex-grow-1 p-4">
            @if (TempData.ContainsKey("message"))
            {
                var messageType = TempData["messageType"]?.ToString() ?? "success";
                var bgClass = messageType switch
                {
                    "error" => "bg-danger",
                    "warning" => "bg-warning",
                    _ => "bg-success"
                };
                var iconClass = messageType switch
                {
                    "error" => "fa-exclamation-circle",
                    "warning" => "fa-info-circle",
                    _ => "fa-check-circle"
                };
                <div class="position-fixed top-0 end-0 p-3" style="z-index: 9999">
                    <div class="toast show" role="alert">
                        <div class="toast-header @bgClass text-white">
                            <strong class="me-auto">@messageType.ToUpper()</strong>
                            <small class="text-white">Just now</small>
                            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="toast"></button>
                        </div>
                        <div class="toast-body">
                            <i class="fas @iconClass me-2"></i> @Html.Encode(TempData["message"])
                        </div>
                    </div>
                </div>
            }

            <div class="d-flex justify-content-between align-items-center mb-4 py-3 border-bottom">
                <div>
                    <h1 class="h2 mb-0">@ViewData["Title"]</h1>
                    @if (ViewData["Description"] != null)
                    {
                        <p class="text-muted mb-0">@ViewData["Description"]</p>
                    }
                </div>
                <div>
                    @RenderSection("HeaderButtons", required: false)
                </div>
            </div>

            @RenderBody()
        </main>

        <!-- Footer -->
        <footer class="footer mt-auto py-3 bg-light border-top text-center small">
            © @DateTime.Now.Year - Asset Manager
        </footer>
    </div>

    <!-- Scripts -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>

    @if (action == "Create" || action == "Edit")
    {
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.19.5/jquery.validate.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validation-unobtrusive/3.2.12/jquery.validate.unobtrusive.min.js"></script>
    }

    <script src="~/js/site.js" asp-append-version="true"></script>
    @await RenderSectionAsync("Scripts", required: false)

    <noscript>
        <div class="alert alert-warning m-3">
            <h4>JavaScript is disabled</h4>
            <p>This application requires JavaScript to function properly.</p>
        </div>
    </noscript>
</body>
</html>
