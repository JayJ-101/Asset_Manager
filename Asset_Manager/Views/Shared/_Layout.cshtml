@{
    var current = ViewContext.RouteData.Values["area"]?.ToString() ??
                  ViewContext.RouteData.Values["controller"]?.ToString() ?? "Home";
    var action = ViewContext.RouteData.Values["action"]?.ToString() ?? "Index";
}

<!DOCTYPE html>
<html lang="en" data-bs-theme="light">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="Enterprise Asset Management System" />
    <title>@ViewData["Title"] - Asset Manager</title>

    <!-- Preload & Favicons -->
    <link rel="preload" href="~/css/site.css" as="style" />
    <link rel="icon" href="~/favicon.ico" type="image/x-icon" />
    <link rel="apple-touch-icon" sizes="180x180" href="~/apple-touch-icon.png" />

    <!-- Font Awesome & Bootstrap -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
          crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link href="~/lib/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet" />

    <!-- Custom CSS -->
    <link rel="stylesheet" href="~/css/site.css" asp-append-version="true" />
    @RenderSection("Styles", required: false)
</head>
<body class="d-flex min-vh-100 bg-light">
    <!-- Sidebar -->
    <nav id="sidebarMenu" class="d-flex flex-column flex-shrink-0 p-3 bg-primary text-white offcanvas-lg offcanvas-start" style="width: 250px; min-width: 250px;" tabindex="-1">
        <a class="d-flex align-items-center mb-3 mb-md-0 me-md-auto text-white text-decoration-none"
           asp-area="" asp-controller="Home" asp-action="Index">
            <i class="fas fa-server me-2 fs-5"></i>
            <span class="fs-5 fw-bold">Asset Manager</span>
        </a>
        <hr class="text-white opacity-25" />

        <ul class="nav nav-pills flex-column mb-auto sidebar-nav">
            <li class="nav-item">
                <a class="nav-link d-flex align-items-center py-2 px-3 rounded
                      @(current == "Home" ? "active bg-dark" : "text-white hover-light")"
                   asp-controller="Home" asp-action="Index">
                    <i class="fas fa-home me-2"></i> <span>Dashboard</span>
                </a>
            </li>

            <li>
                <a class="nav-link d-flex justify-content-between align-items-center py-2 px-3 rounded
                      @(current == "Asset" || current == "AssetAssignment" || current == "MaintenanceLog" ? "active bg-dark" : "text-white hover-light")"
                   data-bs-toggle="collapse" href="#assetsMenu" role="button"
                   aria-expanded="@(current == "Asset" || current == "AssetAssignment" || current == "MaintenanceLog" ? "true" : "false")">
                    <span><i class="fas fa-laptop me-2"></i> Assets</span>
                    <i class="fas fa-chevron-down small transition @(current == "Asset" || current == "AssetAssignment" || current == "MaintenanceLog" ? "rotate" : "")"></i>
                </a>
                <div class="collapse submenu @(current == "Asset" || current == "AssetAssignment" || current == "MaintenanceLog" ? "show" : "")" id="assetsMenu">
                    <a class="nav-link small d-block py-2 ps-5 pe-3 text-white hover-light @(current == "Asset" ? "fw-bold" : "")"
                       asp-controller="Asset" asp-action="Index">All Assets</a>
                    <a class="nav-link small d-block py-2 ps-5 pe-3 text-white hover-light @(current == "AssetAssignment" ? "fw-bold" : "")"
                       asp-controller="AssetAssignment" asp-action="Index">Assignments</a>
                    <a class="nav-link small d-block py-2 ps-5 pe-3 text-white hover-light @(current == "MaintenanceLog" ? "fw-bold" : "")"
                       asp-controller="MaintenanceLog" asp-action="Index">Maintenance</a>
                </div>
            </li>

            <li>
                <a class="nav-link d-flex justify-content-between align-items-center py-2 px-3 rounded
                      @(current == "Supplier" || current == "Category" || current == "Branch" || current == "Department" ? "active bg-dark" : "text-white hover-light")"
                   data-bs-toggle="collapse" href="#mgmtMenu" role="button"
                   aria-expanded="@(current == "Supplier" || current == "Category" || current == "Branch" || current == "Department" ? "true" : "false")">
                    <span><i class="fas fa-cog me-2"></i> Management</span>
                    <i class="fas fa-chevron-down small transition @(current == "Supplier" || current == "Category" || current == "Branch" || current == "Department" ? "rotate" : "")"></i>
                </a>
                <div class="collapse submenu @(current == "Supplier" || current == "Category" || current == "Branch" || current == "Department" ? "show" : "")" id="mgmtMenu">
                    <a class="nav-link small d-block py-2 ps-5 pe-3 text-white hover-light @(current == "Supplier" ? "fw-bold" : "")"
                       asp-controller="Supplier" asp-action="Index">Suppliers</a>
                    <a class="nav-link small d-block py-2 ps-5 pe-3 text-white hover-light @(current == "Category" ? "fw-bold" : "")"
                       asp-controller="Category" asp-action="Index">Categories</a>
                    <a class="nav-link small d-block py-2 ps-5 pe-3 text-white hover-light @(current == "Branch" ? "fw-bold" : "")"
                       asp-controller="Branch" asp-action="Index">Branches</a>
                    <a class="nav-link small d-block py-2 ps-5 pe-3 text-white hover-light @(current == "Department" ? "fw-bold" : "")"
                       asp-controller="Department" asp-action="Index">Departments</a>
                </div>
            </li>
        </ul>
    </nav>

       
        
    </nav>

    <!-- Main Area -->
    <div class="flex-grow-1 d-flex flex-column">
        <!-- Top Navbar -->
        <header class="navbar navbar-light bg-white shadow-sm px-3">
            <button class="btn btn-outline-primary d-lg-none me-2" type="button" data-bs-toggle="offcanvas" data-bs-target="#sidebarMenu">
                <i class="fas fa-bars"></i>
            </button>

            <form class="d-flex me-auto" asp-controller="Asset" asp-action="Index" method="get">
                <input class="form-control form-control-sm me-2" type="search" placeholder="Search..." name="searchQuery" />
                <button class="btn btn-primary btn-sm" type="submit"><i class="fas fa-search"></i></button>
            </form>
            <div class="dropdown">
                <a href="#" class="d-flex align-items-center text-white text-decoration-none dropdown-toggle"
                   id="userMenu" data-bs-toggle="dropdown" aria-expanded="false">
                    <img src="~/img/user.png" alt="" width="32" height="32" class="rounded-circle me-2">
                    <strong>User</strong>
                </a>
                <ul class="dropdown-menu dropdown-menu-dark text-small shadow" aria-labelledby="userMenu">
                    <li><a class="dropdown-item" href="#">Profile</a></li>
                    <li><hr class="dropdown-divider" /></li>
                    <li><a class="dropdown-item" asp-controller="Account" asp-action="Logout">Sign out</a></li>
                </ul>
            </div>

            <div>
                @RenderSection("ActionButtons", required: false)
            </div>
        </header>

        <!-- Main Content -->
        <main id="main-content" class="flex-grow-1 p-4">
            @if (TempData.ContainsKey("message"))
            {
                var messageType = TempData["messageType"]?.ToString() ?? "success";
                var bgClass = messageType switch
                {
                    "error" => "bg-danger",
                    "warning" => "bg-warning",
                    _ => "bg-success"
                };
                var iconClass = messageType switch
                {
                    "error" => "fa-exclamation-circle",
                    "warning" => "fa-info-circle",
                    _ => "fa-check-circle"
                };
                <div class="position-fixed top-0 end-0 p-3" style="z-index: 9999">
                    <div class="toast show" role="alert">
                        <div class="toast-header @bgClass text-white">
                            <strong class="me-auto">@messageType.ToUpper()</strong>
                            <small class="text-white">Just now</small>
                            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="toast"></button>
                        </div>
                        <div class="toast-body">
                            <i class="fas @iconClass me-2"></i> @Html.Encode(TempData["message"])
                        </div>
                    </div>
                </div>
            }

            <div class="d-flex justify-content-between align-items-center mb-4 py-3 border-bottom">
                <div>
                    <h1 class="h2 mb-0">@ViewData["Title"]</h1>
                    @if (ViewData["Description"] != null)
                    {
                        <p class="text-muted mb-0">@ViewData["Description"]</p>
                    }
                </div>
                <div>
                    @RenderSection("HeaderButtons", required: false)
                </div>
            </div>

            @RenderBody()
        </main>

        <!-- Footer -->
        <footer class="footer mt-auto py-3 bg-light border-top text-center small">
            © @DateTime.Now.Year - Asset Manager
        </footer>
    </div>

    <!-- Scripts -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>

    @if (action == "Create" || action == "Edit")
    {
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.19.5/jquery.validate.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validation-unobtrusive/3.2.12/jquery.validate.unobtrusive.min.js"></script>
    }

    <script src="~/js/site.js" asp-append-version="true"></script>
    @await RenderSectionAsync("Scripts", required: false)

    <noscript>
        <div class="alert alert-warning m-3">
            <h4>JavaScript is disabled</h4>
            <p>This application requires JavaScript to function properly.</p>
        </div>
    </noscript>
</body>
</html>
